using System;
using System.Collections.Generic;
using System.Linq;
using System.Runtime.InteropServices;
using System.Linq.Expressions;
using System.IO;
using System.Dynamic;
using System.Text;

namespace ConsoleApp13
{
    enum Language
    {
        Russian,
        English,
        Japanese
    }
    enum Company
    {
        Company_1,
        Company_2,
        Company_3,
        Company_4
    }
    class Person
    {
        String ID { get; set; }
        String Fname { get; set; }
        String Lname { get; set; }
        String Email { get; set; }
        public Language L { get; set; }
        public float Salary { get; set; }
        public Company C { get; set; }

        public static Person Create(String str) {
            Person p = new Person();
            string[] e = str.Split(',');
            p.ID = e[0].Trim();
            p.Fname = e[1].Trim();
            p.Lname = e[2].Trim();
            p.Email = e[3].Trim();
            String tmp = e[4].Trim();
            if(tmp == "Russian")
            {
                p.L = Language.Russian;
            } else if (tmp == "English")
            {
                p.L = Language.English;
            } else
            {
                p.L = Language.Japanese;
            }
            p.Salary = Convert.ToSingle(e[5].TrimStart('$').Replace('.', ','));
            String com = e[6].Trim();
            if(com == "Company_1")
            {
                p.C = Company.Company_1;
            } else if (com == "Company_2")
            {
                p.C = Company.Company_2;
            } else if (com == "Company_3")
            {
                p.C = Company.Company_3;
            } else
            {
                p.C = Company.Company_4;
            }

                return p;
        }

        public override string ToString()
        {
            String s = string.Format(
                "***************************************************************\n" +
                "ID: {0}, First Name: {1}, Last Name: {2}, Language: {3}\n" +
                "E-mail: {4}, Salary: {5}$, Company: {6}",
                ID, Fname, Lname, L, Email, Salary, CompanyToStr(C));
            return s;
        }

        private static String CompanyToStr(Company c)
        {
            if (c == Company.Company_1) return "#1";
            else if (c == Company.Company_2) return "#2";
            else if (c == Company.Company_3) return "#3";
            else return "#4";
        }
    }
    class Program
    {
        static void Main(string[] args)
        {
            Console.BackgroundColor = ConsoleColor.DarkBlue;
            Console.ForegroundColor = ConsoleColor.Gray;
            Console.Clear();
            Console.Title = "Task #11. File data processing";

            StreamReader file = new StreamReader("data.csv");
#if !DEBUG 
            TextWriter save_out = Console.Out;
            var new_out = new StreamWriter(@"output.txt");
            Console.SetOut(new_out);
#endif
            List<Person> all = new List<Person>();
            try
            {
                String line = file.ReadLine();
                while((line = file.ReadLine()) != null)
                {
                    all.Add(Person.Create(line));
                }
           } catch (Exception e)
           {
                Console.WriteLine(e.Message);
           }

            int k = all.Count;
            Console.WriteLine("All employees > {0}", k);
            foreach (var p in all) Console.WriteLine(p);

//самая высокая зарплата в каждой компании
            Console.ForegroundColor = ConsoleColor.Blue;
            Console.WriteLine("\n*******Task #1*******");
            float max1 = (from p in all where p.C == Company.Company_1 select p.Salary).Max();
            float max2 = (from p in all where p.C == Company.Company_2 select p.Salary).Max();
            float max3 = (from p in all where p.C == Company.Company_3 select p.Salary).Max();
            float max4 = (from p in all where p.C == Company.Company_4 select p.Salary).Max();
            Console.WriteLine("The highest salary in the Company #1 > " + max1);
            Console.WriteLine("The highest salary in the Company #2 > " + max2);
            Console.WriteLine("The highest salary in the Company #3 > " + max3);
            Console.WriteLine("The highest salary in the Company #4 > " + max4);

//расчет количества сотрудников в каждой компании
            Console.WriteLine("\n*******Task #2*******");
            int count1 = all.FindAll(p => p.C == Company.Company_1).ToList().Count;
            int count2 = all.FindAll(p => p.C == Company.Company_2).ToList().Count;
            int count3 = all.FindAll(p => p.C == Company.Company_3).ToList().Count;
            int count4 = k - count1 - count2 - count3;
            Console.WriteLine("Number of employees in the Company #1 > " + count1);
            Console.WriteLine("Number of employees in the Company #2 > " + count2);
            Console.WriteLine("Number of employees in the Company #3 > " + count3);
            Console.WriteLine("Number of employees in the Company #4 > " + count4);

//расчет количества сотрудников в каждой языковой группе
            Console.WriteLine("\n*******Task #3*******");
            int jap = all.FindAll(p => p.L == Language.Japanese).ToList().Count;
            int rus = all.FindAll(p => p.L == Language.Russian).ToList().Count;
            int eng = k - jap - rus;
            Console.WriteLine("Number of English employees > " + eng);
            Console.WriteLine("Number of Russian employees > " + rus);
            Console.WriteLine("Number of Japanese employees > " + jap);

//расчет количества сотрудников, чья зарплата выше средней по общей выборке            
            Console.WriteLine("\n*******Task #4*******");
            int counts = 0;
            float aves = (from p in all select p.Salary).Average();
            foreach (var p in all)
            {
                if(p.Salary > aves) { counts++; }
            }
            Console.WriteLine("Average salary > " + aves);
            Console.WriteLine("Number of employees whose salary is higher than average one > " + counts);

#if !DEBUG
            Console.SetOut(save_out);
            new_out.Close();
#else
                Console.ReadKey();
#endif

        }
    }
}
